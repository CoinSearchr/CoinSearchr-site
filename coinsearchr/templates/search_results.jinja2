{% extends 'base.jinja2' %}

{% block title %} '{{ data["search_term"] }}' Search {% endblock %}

{% block content %}

	<div class="album py-5 bg-light">
		<div class="container">
			{% for _, row in df.head(1).iterrows() %}
				<div class="col">
					<div class="card shadow-sm h-100">

						<div class="row">
							<div class="col-md-6">
								<img src="{{ row['image'] }}" class="card-img-top crypto-logo mx-auto" alt="{{ row['name'] }} logo">
							</div>

							<div class="col-md-6">
								<!-- Graph -->
								{# TODO put a graph here with the sparkline data #}
							</div>
						</div>



						<div class="card-body">
							<h5 class="card-title">{{ row['name'] }} ({{ row['symbol'] | upper }})</h5>
							<!-- <p class="card-text">This is a wider card with supporting text.</p> -->
							<div class="d-flex justify-content-between align-items-center">
								<div class="btn-group">
									<a role="button" href="https://www.coingecko.com/en/coins/{{ row['id'] }}" class="btn btn-sm btn-outline-primary">View on CoinGecko</a>
									<button type="button" class="btn btn-sm btn-outline-primary">Quick Conversion</button>
								</div>
							</div>
						</div>


						<ul class="list-group list-group-flush">
							<li class="list-group-item">
								<span class="coin-data-label">Price</span>
								<span class="coin-data-value">{{ data['units_prefix']}}{{ row['current_price'] | format_currency_num }}{{ data['units_suffix']}}</span>
							</li>
							<li class="list-group-item">
								<span class="coin-data-label">Market Cap</span>
								<span class="coin-data-value">{{ data['units_prefix']}}{{ row['market_cap'] | format_currency_num }}{{ data['units_suffix']}} <span class="text-muted">(#{{ row['market_cap_rank'] | int }})</span></span>
							</li>
							<li class="list-group-item">
								<span class="coin-data-label">24h Price</span>
								<span class="coin-data-value">{{ data['units_prefix']}}{{ row['low_24h'] | format_currency_num }}{{ data['units_suffix']}} to {{ data['units_prefix']}}{{ row['high_24h'] | format_currency_num }}{{ data['units_suffix']}}</span>
							</li>
						</ul>
						
						<div class="card-footer">
							<small class="text-muted">Last updated {{ row['last_updated'] | time_ago }}</small> {# TODO change this to a JS auto-update thing for when people leave the tab open #}
						</div>

					</div>
		
				</div>

			{% endfor %}
		</div>
	</div>

	<section class="py-2 text-center container">
		<div class="row py-lg-1">
			<div class="col-lg-6 col-md-8 mx-auto">
				<h1 class="fw-light">'{{ data["search_term"] }}' Search Results</h1>
				<p class="lead text-muted">{{ df.index | length }}{{ data["show_plus_on_result_count"] }} cryptocurrency matches found.</p>
				<!--
				<p>
					<a href="#" class="btn btn-primary my-2">Main call to action</a>
					<a href="#" class="btn btn-secondary my-2">Secondary action</a>
				</p>
				-->
			</div>
		</div>
	</section>

	<div class="album py-5 bg-light">
		<div class="container">

			<div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">

				{% for _, row in df.iloc[1:].iterrows() %}
					<div class="col">
						<div class="card shadow-sm h-100">
							<img src="{{ row['image'] }}" class="card-img-top crypto-logo mx-auto" alt="{{ row['name'] }} logo">


							<div class="card-body">
								<h5 class="card-title">{{ row['name'] }} ({{ row['symbol'] | upper }})</h5>
								<!-- <p class="card-text">This is a wider card with supporting text.</p> -->
								<div class="d-flex justify-content-between align-items-center">
									<div class="btn-group">
										<a role="button" href="https://www.coingecko.com/en/coins/{{ row['id'] }}" class="btn btn-sm btn-outline-primary">View on CoinGecko</a>
										<button type="button" class="btn btn-sm btn-outline-primary">Quick Conversion</button>
									</div>
								</div>
							</div>


							<ul class="list-group list-group-flush">
								<li class="list-group-item">
									<span class="coin-data-label">Price</span>
									<span class="coin-data-value">{{ data['units_prefix']}}{{ row['current_price'] | format_currency_num }}{{ data['units_suffix']}}</span>
								</li>
								<li class="list-group-item">
									<span class="coin-data-label">Market Cap</span>
									<span class="coin-data-value">{{ data['units_prefix']}}{{ row['market_cap'] | format_currency_num }}{{ data['units_suffix']}} <span class="text-muted">(#{{ row['market_cap_rank'] }})</span></span>
								</li>
								<li class="list-group-item">
									<span class="coin-data-label">24h Price</span>
									<span class="coin-data-value">{{ data['units_prefix']}}{{ row['low_24h'] | format_currency_num }}{{ data['units_suffix']}} to {{ data['units_prefix']}}{{ row['high_24h'] | format_currency_num }}{{ data['units_suffix']}}</span>
								</li>
							</ul>
							<!--
							<div class="card-body text-center">
								<a onclick="javascript:expand_this_data_list()" href="#" class="card-link data-expand">Expand</a>
							</div>
							--> {# TODO implement this expand button #}
							<div class="card-footer">
								<small class="text-muted">Last updated {{ row['last_updated'] | time_ago }}</small> {# TODO change this to a JS auto-update thing for when people leave the tab open #}
							</div>
						</div>
					</div>

				{% endfor %}
			</div>
		</div>
	</div>
{% endblock %}


{% block tail_scripts %}
	<script>
		function expand_this_data_list() {
			alert("Someone should implement this.");
		}
	</script>

{% endblock %}

